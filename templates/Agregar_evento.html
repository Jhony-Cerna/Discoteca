<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Evento</title>
    <link rel="stylesheet" href="../static/CSS/Agregar_evento.css">
</head>
<body>
    <div class="container">
        <h1>Registrar Evento</h1>

        <!-- Formulario de registro -->
        <form action="/agregar_evento" method="POST">
            <div class="form-container">
                <!-- Parte izquierda del formulario -->
                <div class="form-left">
                    <label for="nombre">Nombre del Evento:</label>
                    <input type="text" id="nombre" name="nombre" placeholder="Ingrese el nombre del evento" required>

                    <label for="descripcion">Descripción:</label>
                    <textarea id="descripcion" name="descripcion" placeholder="Ingrese una descripción" required></textarea>

                    <label for="direccion">Dirección:</label>
                    <input type="text" id="direccion" name="direccion" placeholder="Ingrese la dirección" required>
                </div>

                <!-- Parte derecha del formulario -->
                <div class="form-right">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" name="fecha" required>

                    <label for="hora">Hora:</label>
                    <input type="time" id="hora" name="hora" required>
                </div>
            </div>

            <!-- Selección de artistas -->
            <h2>Seleccionar Artista</h2>
            <div class="seleccion-artista">
                <select id="artista">
                    {% for artista in artistas %}
                        <option value="{{ artista[0] }}">{{ artista[1] }}</option>
                    {% else %}
                        <option value="">No hay artistas disponibles</option>
                    {% endfor %}
                </select>

                <div class="buttons">
                    <button type="button" class="btn-crear-artista" id="agregar-artista">Agregar Artista</button>
                    <a href="/artistas" id="crear-artista-link" class="btn-crear-artista">Crear Artista</a>
                </div>
            </div>

            <!-- Tabla de artistas agregados -->
            <table id="tabla-artistas">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Género Musical</th>
                        <th>Imagen</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Las filas de artistas se agregarán dinámicamente aquí -->
                </tbody>
            </table>

            <!-- Botones finales -->
            <div class="botones-finales">
                <button type="button" class="btn-imagenes">Imágenes</button>
                <button type="submit" class="btn-enviar">Enviar</button>
            </div>
        </form>
    </div>
    <script src="../static/js/agregar_artista.js"></script>
    <script>
        function saveFormData() {
            const formData = {
                nombre: document.getElementById('nombre').value,
                descripcion: document.getElementById('descripcion').value,
                direccion: document.getElementById('direccion').value,
                fecha: document.getElementById('fecha').value,
                hora: document.getElementById('hora').value,
                artistas: []
            };

            const tableRows = document.querySelectorAll('#tabla-artistas tbody tr');
            tableRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                formData.artistas.push({
                    nombre: cells[0].innerText,
                    genero: cells[1].innerText,
                    imagen: cells[2].innerText
                });
            });

            localStorage.setItem('formData', JSON.stringify(formData));
        }
        
        document.getElementById('crear-artista-link').addEventListener('click', (e) => {
            e.preventDefault();
            saveFormData();
            window.location.href = '/artistas';
        });
        
        window.addEventListener('load', () => {
            const savedData = JSON.parse(localStorage.getItem('formData'));
            if (savedData) {
                document.getElementById('nombre').value = savedData.nombre;
                document.getElementById('descripcion').value = savedData.descripcion;
                document.getElementById('direccion').value = savedData.direccion;
                document.getElementById('fecha').value = savedData.fecha;
                document.getElementById('hora').value = savedData.hora;

                const tbody = document.querySelector('#tabla-artistas tbody');
                savedData.artistas.forEach(artista => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${artista.nombre}</td>
                        <td>${artista.genero}</td>
                        <td>${artista.imagen}</td>
                        <td><button type="button" class="btn-eliminar">Eliminar</button></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        });
    </script>
</body>
</html>
